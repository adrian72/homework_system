{# app/templates/student/courses.html #}
{% extends "base.html" %}

{% block title %}我的课程 - 作业批改系统{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2 class="mb-4">
            <i class="fas fa-book me-2"></i> 我的课程
        </h2>
        <div class="alert alert-info">
            <div class="d-flex">
                <div class="me-3">
                    <i class="fas fa-info-circle fa-2x"></i>
                </div>
                <div>
                    <h5>课程管理</h5>
                    <p class="mb-0">查看已选课程，浏览可选课程并进行选课。</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <ul class="nav nav-tabs" id="coursesTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="my-courses-tab" data-bs-toggle="tab" data-bs-target="#my-courses" type="button" role="tab" aria-controls="my-courses" aria-selected="true">
                    <i class="fas fa-book me-2"></i> 我的课程
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="available-courses-tab" data-bs-toggle="tab" data-bs-target="#available-courses" type="button" role="tab" aria-controls="available-courses" aria-selected="false">
                    <i class="fas fa-plus-circle me-2"></i> 可选课程
                </button>
            </li>
        </ul>
        
        <div class="tab-content p-3 border border-top-0 rounded-bottom bg-white" id="coursesTabsContent">
            <!-- 我的课程 -->
            <div class="tab-pane fade show active" id="my-courses" role="tabpanel" aria-labelledby="my-courses-tab">
                {% if courses %}
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {% for course in courses %}
                            <div class="col">
                                <div class="card h-100 course-card">
                                    {% if course.cover_image %}
                                        <img src="{{ course.cover_image }}" class="card-img-top" alt="{{ course.name }}" style="height: 150px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 150px;">
                                            <i class="fas fa-book fa-3x text-muted"></i>
                                        </div>
                                    {% endif %}
                                    <div class="card-body">
                                        <h5 class="card-title">{{ course.name }}</h5>
                                        <p class="card-text text-muted">{{ course.teacher.username }} 老师</p>
                                        {% if course.description %}
                                            <p class="card-text small">{{ course.description|truncate(100) }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="card-footer bg-white border-top-0">
                                        <a href="{{ url_for('student_views.course_detail', course_id=course.id) }}" class="btn btn-primary btn-sm w-100">
                                            <i class="fas fa-eye me-1"></i> 查看课程
                                        </a>
                                        <form action="{{ url_for('student_views.unenroll_course', course_id=course.id) }}" method="post" class="mt-2">
                                            <button type="submit" class="btn btn-outline-danger btn-sm w-100" onclick="return confirm('确定要退选该课程吗？')">
                                                <i class="fas fa-times me-1"></i> 退选课程
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-book fa-3x text-muted mb-3"></i>
                        <h4>暂无选修课程</h4>
                        <p class="text-muted">您还没有选择任何课程，请前往"可选课程"选课。</p>
                        <button class="btn btn-primary" id="go-to-available-btn">
                            <i class="fas fa-plus-circle me-1"></i> 查看可选课程
                        </button>
                    </div>
                {% endif %}
            </div>
            
            <!-- 可选课程 -->
            <div class="tab-pane fade" id="available-courses" role="tabpanel" aria-labelledby="available-courses-tab">
                {% if available_courses %}
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {% for course in available_courses %}
                            <div class="col">
                                <div class="card h-100 course-card">
                                    {% if course.cover_image %}
                                        <img src="{{ course.cover_image }}" class="card-img-top" alt="{{ course.name }}" style="height: 150px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 150px;">
                                            <i class="fas fa-book fa-3x text-muted"></i>
                                        </div>
                                    {% endif %}
                                    <div class="card-body">
                                        <h5 class="card-title">{{ course.name }}</h5>
                                        <p class="card-text text-muted">{{ course.teacher.username }} 老师</p>
                                        {% if course.description %}
                                            <p class="card-text small">{{ course.description|truncate(100) }}</p>
                                        {% endif %}
                                        {% if course.start_date and course.end_date %}
                                            <p class="card-text small">
                                                <i class="fas fa-calendar-alt me-1"></i>
                                                {{ course.start_date.strftime('%Y-%m-%d') }} ~ {{ course.end_date.strftime('%Y-%m-%d') }}
                                            </p>
                                        {% endif %}
                                    </div>
                                    <div class="card-footer bg-white border-top-0">
                                        <form action="{{ url_for('student_views.enroll_course', course_id=course.id) }}" method="post">
                                            <button type="submit" class="btn btn-success btn-sm w-100">
                                                <i class="fas fa-plus-circle me-1"></i> 选修课程
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4>暂无可选课程</h4>
                        <p class="text-muted">当前没有您可以选修的课程。</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 让"前往可选课程"按钮生效
        const goToAvailableBtn = document.getElementById('go-to-available-btn');
        if (goToAvailableBtn) {
            goToAvailableBtn.addEventListener('click', function() {
                document.getElementById('available-courses-tab').click();
            });
        }
    });
</script>
{% endblock %}
